# V6 F4 &#35330;&#21934;&#21462;&#28040;&#33287;&#20462;&#27491;&#27231;&#21046; (&#23436;&#25972;&#35215;&#21123;&#26041;&#26696;)

## 1. &#26680;&#24515;&#30446;&#27161;&#33287;&#35373;&#35336;&#21730;&#23416;

* **&#30446;&#27161;**&#65306;&#35299;&#27770;&#12300;&#24050;&#19979;&#21934;/&#29983;&#20132;&#20013;&#12301;&#30340;&#22577;&#20729;&#21934;&#38656;&#35201;&#12300;&#20316;&#24290;&#12301;&#25110;&#12300;&#20462;&#27491;&#25976;&#25818;&#12301;&#30340;&#26989;&#21209;&#22580;&#26223;&#12290;
* **&#26680;&#24515;&#21730;&#23416;**&#65306;
    1.  **&#19981;&#21487;&#36063;&#31680;&#40670; (Point of No Return)**&#65306;&#19968;&#26096;&#35330;&#21934;&#36914;&#20837;&#29983;&#20132;&#27969;&#31243;&#65288;&#29376;&#24907; D~I&#65289;&#65292;&#21407;&#21063;&#19978;&#31105;&#27490;&#30452;&#25509;&#20462;&#25913;&#21407;&#22987;&#27284;&#26696;&#65292;&#20197;&#20445;&#35703;&#27511;&#21490;&#30495;&#23526;&#24615;&#12290;
    2.  **&#21407;&#23376;&#25805;&#20316; (Atomic Operation)**&#65306;&#22312;&#12300;&#20462;&#27491;&#12301;&#22580;&#26223;&#20013;&#65292;&#12300;&#26032;&#21934;&#25104;&#31435;&#12301;&#33287;&#12300;&#33290;&#21934;&#20316;&#24290;&#12301;&#24517;&#38920;&#22312;&#21516;&#19968;&#20491;&#36039;&#26009;&#24235;&#20132;&#26131;&#20013;&#23436;&#25104;&#12290;&#32085;&#19981;&#20801;&#35377;&#30332;&#29983;&#12300;&#26032;&#21934;&#23384;&#20102;&#65292;&#33290;&#21934;&#2136b;&#27794;&#21462;&#28040;&#12301;&#30340;&#28797;&#38627;&#12290;

## 2. &#29376;&#24907;&#23450;&#32681; (Status Definition)

* **&#26032;&#22686;&#29376;&#24907;**: `X. Order Cancelled` (&#35330;&#21934;&#21462;&#28040;)&#12290;
* **&#29376;&#24907;&#24615;&#36074;**: &#27492;&#28858;&#32066;&#23616;&#29376;&#24907; (Terminal State)&#65292;&#19968;&#26096;&#36914;&#20837;&#27492;&#29376;&#24907;&#65292;&#35442;&#35330;&#21934;&#21363;&#34987;&#35222;&#28858;&#28961;&#25928;&#65292;&#19988; UI &#25033;&#20840;&#38754;&#37 streaming&#23450;&#12290;

## 3. &#35443;&#32048;&#22519;&#34892;&#38542;&#27573;&#35215;&#21123;

&#25105;&#20417;&#23559;&#27492;&#20219;&#21209;&#25286;&#35299;&#28858;&#19977;&#20491;&#38542;&#27573;&#22519;&#34892;&#65306;

### &#38542;&#27573;&#19968;&#65306;&#22522;&#30910;&#24314;&#35373;&#33287; UI &#20837;&#21475; (Foundation & UI)

**&#30446;&#27161;**&#65306;&#24314;&#31435;&#29376;&#24907;&#24120;&#25976;&#65292;&#20006;&#22312; F4 &#38754;&#26495;&#25552;&#20379;&#25805;&#20316;&#20837;&#21475;&#12290;

1.  **&#36039;&#26009;&#23652;**&#65306;
    * &#22312; `status-config.js` &#26032;&#22686; `X_CANCELLED` &#29376;&#24907;&#12290;
    * &#22312; `constants.js` &#26032;&#22686;&#20107;&#20214; `USER_REQUESTED_CANCEL_CORRECT`&#12290;
2.  **UI &#23652; (F4)**&#65306;
    * &#22312; F4 &#38754;&#26495;&#24213;&#37096;&#30340;&#12300;Gen-Order&#12301;&#24037;&#20855;&#21312;&#22666;&#21491;&#20599;&#65292;&#26032;&#22686;&#19968;&#20491;&#32005;&#33394;&#30340; **&#12300;Cancel / Correct&#12301;** &#25353;&#37397;&#12290;
    * **&#25353;&#37397;&#27171;&#24335;**&#65306;&#32005;&#33394;&#32972;&#26223; (`.btn-danger`)&#65292;&#24375;&#35abf;&#36889;&#26159;&#19968;&#20491;&#21361;&#38570;/&#37325;&#35201;&#30340;&#25805;&#20316;&#12290;
    * **&#21855;&#29992;&#37007;&#36655;**&#65306;&#27492;&#25353;&#37397;&#20677;&#22312;&#35330;&#21934;&#34389;&#26044;&#12300;&#26377;&#25928;&#29983;&#21629;&#36913;&#26399;&#20839;&#12301;&#19988;&#12300;&#24050;&#23384;&#27284;&#12301;&#26178;&#21487;&#29992;&#65288;&#21363;&#29376;&#24907; B ~ I&#65289;&#12290;&#33509;&#29376;&#24907;&#28858; A (&#23578;&#26410;&#19979;&#21934;) &#25110; J/X (&#24050;&#32080;&#26696;)&#65292;&#21063;&#31105;&#29992;&#12290;

### &#38542;&#27573;&#20108;&#65306;&#20114;&#21205;&#27969;&#31243;&#33287;&#20462;&#27491;&#27169;&#24335; (Interaction & Correction Mode)

**&#30446;&#27161;**&#65306;&#34389;&#29702;&#29992;&#25142;&#40670;&#25802;&#25353;&#37397;&#24460;&#30340;&#27770;&#31574;&#27969;&#31243;&#65292;&#20006;&#23526;&#20316;&#12300;&#20462;&#27491;&#27169;&#24335;&#12301;&#30340; UI &#29376;&#24907;&#12290;

1.  **&#23565;&#35441;&#26694; (Dialog) &#37007;&#36655;**&#65306;
    * &#30070;&#29992;&#25142;&#40670;&#25802;&#12300;Cancel / Correct&#12301;&#26178;&#65292;&#36339;&#20986;&#19968;&#20491;&#38617;&#36984;&#38917;&#23565;&#35441;&#26694;&#65306;
        * &#36984;&#38917; A&#65306;&#21462;&#28040;&#35330;&#21934; (Cancel Order)
        * &#36984;&#38917; B&#65306;&#20462;&#27491;&#25976;&#25818; (Correct Data)
2.  **&#36335;&#24465; A (&#21462;&#28040;) &#23526;&#20316;**&#65306;
    * &#40670;&#25802;&#24460;&#65292;&#31995;&#32113;&#35201;&#27714;&#36664;&#20837;&#12300;&#21462;&#28040;&#21407;&#22240;&#12301;&#12290;
    * &#30906;&#35469;&#24460;&#65292;&#30452;&#25509;&#21628;&#21483;&#24460;&#31471;&#23559;&#29376;&#24907;&#26356;&#26032;&#28858; X&#12290;
3.  **&#36335;&#24465; B (&#20462;&#27491;) &#23526;&#20316; - &#21069;&#31471;&#37096;&#20998;**&#65306;
    * **&#36914;&#20837;&#20462;&#27491;&#27169;&#24335;**&#65306;&#33509;&#29992;&#25142;&#36984;&#25799; B&#65292;&#31995;&#32113;&#19981;&#31435;&#21363;&#20462;&#25913;&#36039;&#26009;&#65292;&#32780;&#26159;&#65306;
        * &#22312; Redux ui &#29376;&#24907;&#20013;&#35373;&#23450; `isCorrectionMode = true`&#12290;
        * **&#35299;&#37 streaming UI**&#65306;&#20801;&#35377;&#29992;&#25142;&#20462;&#25913;&#21407;&#26412;&#22240;&#12300;&#29983;&#20132;&#20013;&#12301;&#32780;&#34987;&#37 streaming&#23450;&#30340;&#27396;&#20301;&#12290;
        * **&#35222;&#35258;&#25552;&#31034;**&#65306;&#22312;&#20171;&#38754;&#19978;&#26041;&#39023;&#31034;&#37266;&#30446;&#30340;&#40643;&#33394;&#27243;&#24133;&#65306;&#12300;&#20462;&#27491;&#27169;&#24335;&#65306;&#24744;&#27491;&#22312;&#32232;&#36655;&#20462;&#27491;&#29256;&#12290;&#23384;&#27284;&#24460;&#23559;&#33258;&#21205;&#20316;&#24290;&#21407;&#35330;&#21934;&#12290;&#12301;
    * &#27492;&#26178;&#65292;&#21407;&#26412;&#30340;&#12300;Save&#12301;&#25353;&#37397;&#34892;&#28858;&#23559;&#34987;&#25913;&#35 p&#65288;&#35443;&#35211;&#38542;&#27573;&#19977;&#65289;&#12290;

### &#38542;&#27573;&#19977;&#65306;&#21407;&#23376;&#21270;&#23384;&#27284;&#33287;&#24460;&#31471;&#37007;&#36655; (Atomic Persistence)

**&#30446;&#27161;**&#65306;&#36889;&#26159;&#26368;&#38364;&#37749;&#30340;&#38542;&#27573;&#65292;&#23526;&#20316;&#12300;&#33290;&#21934;&#27515;&#12289;&#26032;&#21934;&#29983;&#12301;&#30340;&#21516;&#27493;&#37007;&#36655;&#12290;

1.  **&#25rg&#25130;&#20786;&#23384;&#21205;&#20316;**&#65306;
    * &#22312; `QuotePersistenceService` &#20013;&#65292;&#30070;&#29992;&#25142;&#25353;&#19979;&#12300;Save&#12301;&#26178;&#65292;&#27298;&#26597; `ui.isCorrectionMode`&#12290;
    * **&#33509;&#28858; `true`**&#65292;&#21063;&#19981;&#22519;&#34892;&#27169;&#28310;&#30340; `saveQuoteToCloud` (&#35206;&#33 cover)&#65292;&#32780;&#26159;&#36681;&#21521;&#22519;&#34892;&#26032;&#30340; `handleCorrectionSave` &#26041;&#27861;&#12290;
2.  **&#23526;&#20316; `handleCorrectionSave` (&#26680;&#24515;&#37007;&#36655;)**&#65306;
    * **&#28310;&#20633;&#26032;&#21934; (v2)**&#65306;
        * &#35079;&#35069;&#30076;&#21069;&#65288;&#24050;&#20462;&#25913;&#30340;&#65289;&#36039;&#26009;&#12290;
        * &#29983;&#25104;&#26032;&#30340; Quote ID (&#20363;&#22914; RB-001-v2)&#12290;
        * &#23559;&#29376;&#24907;&#37325;&#32622;&#28858; `A. Saved` (&#25110; `B. Order Valid`)&#12290;
        * &#26356;&#26032; `creationDate`&#12290;
    * **&#28310;&#20633;&#33290;&#21934; (v1)**&#65306;
        * &#28310;&#20633;&#19968;&#20491;&#26356;&#26032;&#25351;&#20196;&#65292;&#23559;&#21407; ID (RB-001-v1) &#30340;&#29376;&#24907;&#25913;&#28858; `X. Order Cancelled`&#12290;
        * &#23531;&#20837;&#35387;&#35352;&#21407;&#22240;&#65306;`"Replaced by RB-001-v2"`&#12290;
    * **&#22519;&#34892; Firestore Batch Write (&#25209;&#27425;&#23531;&#20837;)**&#65306;
        * &#20351;&#29992; Firebase SDK &#30340; `writeBatch()` &#21151;&#33021;&#12290;
        * &#23559;&#12300;&#23531;&#20837;&#26032;&#21934;&#12301;&#33287;&#12300;&#26356;&#26032;&#33290;&#21934;&#12301;&#25171;&#21253;&#25104;&#19968;&#20491; atomic batch&#12290;
        * Commit&#65306;&#30906;&#20445;&#20841;&#32773;&#21516;&#26178;&#25104;&#21151;&#65292;&#33509;&#20219;&#19968;&#22833;&#25943;&#21063;&#20840;&#25976;&#22238;&#25 scroll&#12290;
3.  **&#24460;&#32396;&#34389;&#29702;**&#65306;
    * &#23384;&#27284;&#25104;&#21151;&#24460;&#65292;&#31995;&#32113;&#33258;&#21205;&#36664;&#20837;&#26032;&#30340; v2 &#35330;&#21934;&#12290;
    * &#35299;&#38500; `isCorrectionMode`&#12290;
    * &#39023;&#31034;&#25104;&#21151;&#35338;&#24687;&#65306;&#12300;&#20462;&#27491;&#29256;&#24050;&#24314;&#31435; (v2)&#65292;&#21407;&#35330;&#21934; (v1) &#24050;&#20316;&#24290;&#12301;&#12290;

## 4. &#23565;&#26044;&#24037;&#24288;&#33287;&#26371;&#35336; App &#30340;&#24433;&#38911; (&#20100;&#24819;)

&#36889;&#20491;&#26041;&#26696;&#28858;&#26410;&#20358;&#30340; App &#33306;&#24179;&#20102;&#36947;&#36335;&#65306;

* **&#24037;&#24288; App**&#65306;
    * &#24037;&#24288;&#31471;&#21482;&#38656;&#30435;&#32893; Firestore&#12290;&#30076;&#25910;&#21040; `status = X` &#30340;&#26356;&#26032;&#26178;&#65292;&#21363;&#21051;&#20572;&#27490;&#35442;&#21934;&#34399;&#30340;&#29983;&#20135;&#12290;
    * &#30076;&#25910;&#21040;&#26032;&#21934;&#34399; (v2) &#26178;&#65292;&#35222;&#28858;&#19968;&#31558;&#20840;&#26032;&#35330;&#21934;&#36914;&#20837;&#25490;&#31243;&#12290;
    * &#22240;&#28858;&#26159;&#21407;&#23376;&#25805;&#20316;&#65292;&#24037;&#24288;&#19981;&#26371;&#20986;&#29694;&#12300;&#30475;&#21040;&#26032;&#21934; v2&#65292;&#20294; v1 &#30475;&#26159;&#39023;&#31034;&#29983;&#20135;&#20013;&#12301;&#30340;&#28151;&#28102;&#31354;&#31383;&#26399;&#12290;
* **&#26371;&#35336; App**&#65306;
    * &#26371;&#35336;&#31471;&#21487;&#20197;&#28165;&#26970;&#36861;&#36410;&#21040; v1 &#24050;&#20316;&#24290;&#65292;&#19981;&#25033;&#35531;&#27454;&#12290;
    * v1 &#30340;&#21462;&#28040;&#21407;&#22240; (`Replaced by v2`) &#25552;&#20379;&#20102;&#23436;&#25972;&#30340;&#31297;&#26680;&#36556;&#36321; (Audit Trail)&#12290;